# æµ‹è¯•å®Œæ•´æŒ‡å—

æœ¬æ–‡æ¡£æ±‡æ€»äº†é¡¹ç›®çš„æ‰€æœ‰æµ‹è¯•ç›¸å…³ä¿¡æ¯,åŒ…æ‹¬æµ‹è¯•ç”¨ä¾‹æ¸…å•ã€è¿è¡ŒæŒ‡å—å’Œè¦†ç›–ç‡æŠ¥å‘Šã€‚

---

## ğŸ¯ æµ‹è¯•æ¦‚è§ˆ

### æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•ç±» | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|--------|---------|--------|--------|
| UserServiceTest | 22ä¸ª | 100% | ~85% |
| ProductServiceTest | 19ä¸ª | 100% | ~80% |
| OrderServiceTest | 21ä¸ª | 100% | ~85% |
| ReviewServiceTest | 19ä¸ª | 100% | ~90% |
| **æ€»è®¡** | **81ä¸ª** | **100%** | **~85%** |

---

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹æ¸…å•

### UserServiceTest (22ä¸ª)

#### æ³¨å†ŒåŠŸèƒ½ (9ä¸ª)
1. âœ… `testRegister_ValidInput_Success` - æ­£å¸¸æ³¨å†Œ
2. âœ… `testRegister_DuplicateUsername_ThrowsException` - ç”¨æˆ·åé‡å¤
3. âœ… `testRegister_UsernameTooShort_ThrowsException` - ç”¨æˆ·å<4å­—ç¬¦
4. âœ… `testRegister_UsernameTooLong_ThrowsException` - ç”¨æˆ·å>20å­—ç¬¦
5. âœ… `testRegister_UsernameInvalidChars_ThrowsException` - ç”¨æˆ·åå«ç‰¹æ®Šå­—ç¬¦
6. âœ… `testRegister_PasswordTooShort_ThrowsException` - å¯†ç <6å­—ç¬¦
7. âœ… `testRegister_PasswordTooLong_ThrowsException` - å¯†ç >20å­—ç¬¦
8. âœ… `testRegister_EmptyRoles_ThrowsException` - è§’è‰²ä¸ºç©º
9. âœ… `testRegister_MultipleRoles_Success` - ä¹°å®¶+å–å®¶åŒè§’è‰²

#### ç™»å½•/ç™»å‡º (6ä¸ª)
10. âœ… `testLogin_ValidCredentials_Success` - æ­£å¸¸ç™»å½•
11. âœ… `testLogin_UsernameNotExists_ThrowsException` - ç”¨æˆ·ä¸å­˜åœ¨
12. âœ… `testLogin_WrongPassword_ThrowsException` - å¯†ç é”™è¯¯
13. âœ… `testLogin_BannedUser_Success` - è¢«å°ç¦ç”¨æˆ·ç™»å½•
14. âœ… `testLogout_Success` - æ­£å¸¸ç™»å‡º
15. âœ… `testLogout_NotLoggedIn_ThrowsException` - æœªç™»å½•æ—¶ç™»å‡º

#### å¯†ç ä¿®æ”¹ (3ä¸ª)
16. âœ… `testChangePassword_Success` - ä¿®æ”¹å¯†ç æˆåŠŸ
17. âœ… `testChangePassword_WrongOldPassword_ThrowsException` - æ—§å¯†ç é”™è¯¯
18. âœ… `testChangePassword_NewPasswordTooShort_ThrowsException` - æ–°å¯†ç å¤ªçŸ­

#### æŸ¥è¯¢åŠŸèƒ½ (4ä¸ª)
19. âœ… `testGetCurrentUser_NotLoggedIn_ThrowsException` - æœªç™»å½•è·å–å½“å‰ç”¨æˆ·
20. âœ… `testGetUserById_Success` - æ ¹æ®IDè·å–ç”¨æˆ·
21. âœ… `testGetUserById_NotExists_ThrowsException` - è·å–ä¸å­˜åœ¨çš„ç”¨æˆ·
22. âœ… `testGetAllSellers_Success` - è·å–æ‰€æœ‰å–å®¶

---

### ProductServiceTest (19ä¸ª)

#### å‘å¸ƒå•†å“ (10ä¸ª)
1. âœ… `testPublishProduct_ValidInput_Success` - æ­£å¸¸å‘å¸ƒ
2. âœ… `testPublishProduct_NotSeller_ThrowsException` - éå–å®¶å‘å¸ƒ
3. âœ… `testPublishProduct_InvalidPrice_ThrowsException` - ä»·æ ¼æ— æ•ˆ
4. âœ… `testPublishProduct_EmptyTitle_ThrowsException` - æ ‡é¢˜ä¸ºç©º
5. âœ… `testPublishProduct_BannedUser_ThrowsException` - è¢«å°ç¦ç”¨æˆ·å‘å¸ƒ
6. âœ… `testPublishProduct_PriceWithThreeDecimals_ThrowsException` - ä»·æ ¼ä¸‰ä½å°æ•°
7. âœ… `testPublishProduct_PriceTooLarge_ThrowsException` - ä»·æ ¼>1,000,000
8. âœ… `testPublishProduct_TitleTooShort_ThrowsException` - æ ‡é¢˜<2å­—ç¬¦
9. âœ… `testPublishProduct_TitleTooLong_ThrowsException` - æ ‡é¢˜>100å­—ç¬¦
10. âœ… `testPublishProduct_DescriptionTooLong_ThrowsException` - æè¿°>1000å­—ç¬¦

#### ç¼–è¾‘å•†å“ (4ä¸ª)
11. âœ… `testEditProduct_Success` - ç¼–è¾‘æˆåŠŸ
12. âœ… `testEditProduct_NotOwner_ThrowsException` - éæ‰€æœ‰è€…ç¼–è¾‘
13. âœ… `testEditProduct_InvalidPrice_ThrowsException` - ç¼–è¾‘æ—¶ä»·æ ¼æ— æ•ˆ
14. âœ… `testEditProduct_NotExists_ThrowsException` - ç¼–è¾‘ä¸å­˜åœ¨çš„å•†å“

#### ä¸‹æ¶/ä¸Šæ¶ (3ä¸ª)
15. âœ… `testRemoveProduct_Success` - ä¸‹æ¶æˆåŠŸ
16. âœ… `testRemoveProduct_NotOwner_ThrowsException` - éæ‰€æœ‰è€…ä¸‹æ¶
17. âœ… `testReListProduct_Success` - é‡æ–°ä¸Šæ¶

#### æŸ¥è¯¢ (2ä¸ª)
18. âœ… `testGetProductById_NotExists_ThrowsException` - è·å–ä¸å­˜åœ¨çš„å•†å“
19. âœ… `testGetProductsBySeller_Success` - è·å–å–å®¶å•†å“åˆ—è¡¨

---

### OrderServiceTest (21ä¸ª)

#### åˆ›å»ºè®¢å• (7ä¸ª)
1. âœ… `testCreateOrder_ValidInput_Success` - æ­£å¸¸ä¸‹å•
2. âœ… `testCreateOrder_NotBuyer_ThrowsException` - éä¹°å®¶ä¸‹å•
3. âœ… `testCreateOrder_OwnProduct_ThrowsException` - è´­ä¹°è‡ªå·±çš„å•†å“
4. âœ… `testCreateOrder_ProductNotAvailable_ThrowsException` - å•†å“ä¸å¯ç”¨
5. âœ… `testCreateOrder_BannedBuyer_ThrowsException` - è¢«å°ç¦ä¹°å®¶ä¸‹å•
6. âœ… `testCreateOrder_SameProductTwice_ThrowsException` - åŒä¸€å•†å“ä¸‹å•ä¸¤æ¬¡
7. âœ… `testCreateOrder_ProductNotExists_ThrowsException` - å•†å“ä¸å­˜åœ¨

#### ç¡®è®¤è®¢å• (2ä¸ª)
8. âœ… `testConfirmOrder_NotSeller_ThrowsException` - éå–å®¶ç¡®è®¤
9. âœ… `testConfirmOrder_NotOwner_ThrowsException` - ç¡®è®¤åˆ«äººçš„è®¢å•

#### ç¡®è®¤æ”¶è´§ (3ä¸ª)
10. âœ… `testConfirmReceipt_Success_ProductSold` - ç¡®è®¤æ”¶è´§æˆåŠŸ
11. âœ… `testConfirmReceipt_NotBuyer_ThrowsException` - éä¹°å®¶ç¡®è®¤æ”¶è´§
12. âœ… `testConfirmReceipt_NotOwner_ThrowsException` - ç¡®è®¤åˆ«äººçš„è®¢å•

#### å–æ¶ˆè®¢å• (5ä¸ª)
13. âœ… `testCancelOrder_ByBuyer_ReputationChange` - ä¹°å®¶å–æ¶ˆ
14. âœ… `testCancelOrder_BySeller_ReputationChange` - å–å®¶å–æ¶ˆ
15. âœ… `testCancelOrder_ReasonTooShort_ThrowsException` - å–æ¶ˆåŸå› <5å­—ç¬¦
16. âœ… `testCancelOrder_ReasonTooLong_ThrowsException` - å–æ¶ˆåŸå› >200å­—ç¬¦
17. âœ… `testCancelOrder_NotOwner_ThrowsException` - ç¬¬ä¸‰æ–¹å–æ¶ˆè®¢å•

#### æŸ¥è¯¢ (4ä¸ª)
18. âœ… `testGetOrdersByBuyer_Success` - è·å–ä¹°å®¶è®¢å•åˆ—è¡¨
19. âœ… `testGetOrdersBySeller_Success` - è·å–å–å®¶è®¢å•åˆ—è¡¨
20. âœ… `testCanReview_CompletedOrder_ReturnsTrue` - å·²å®Œæˆè®¢å•å¯è¯„ä»·
21. âœ… `testCanReview_PendingOrder_ReturnsFalse` - æœªå®Œæˆè®¢å•ä¸å¯è¯„ä»·

---

### ReviewServiceTest (19ä¸ª)

#### åˆ›å»ºè¯„ä»· (8ä¸ª)
1. âœ… `testCreateReview_Success` - åˆ›å»ºè¯„ä»·æˆåŠŸ
2. âœ… `testCreateReview_NotBuyer_ThrowsException` - éä¹°å®¶è¯„ä»·
3. âœ… `testCreateReview_BannedUser_ThrowsException` - è¢«å°ç¦ç”¨æˆ·è¯„ä»·
4. âœ… `testCreateReview_NotOwner_ThrowsException` - è¯„ä»·åˆ«äººçš„è®¢å•
5. âœ… `testCreateReview_OrderNotCompleted_ThrowsException` - è®¢å•æœªå®Œæˆ
6. âœ… `testCreateReview_AlreadyReviewed_ThrowsException` - é‡å¤è¯„ä»·
7. âœ… `testCreateReview_InvalidRating_TooLow_ThrowsException` - è¯„åˆ†<1
8. âœ… `testCreateReview_InvalidRating_TooHigh_ThrowsException` - è¯„åˆ†>5

#### ä¿¡èª‰æ›´æ–° (5ä¸ª)
9. âœ… `testCreateReview_5Star_ReputationIncrease5` - 5æ˜Ÿï¼Œä¿¡èª‰+5
10. âœ… `testCreateReview_4Star_ReputationIncrease2` - 4æ˜Ÿï¼Œä¿¡èª‰+2
11. âœ… `testCreateReview_3Star_ReputationNoChange` - 3æ˜Ÿï¼Œä¿¡èª‰0
12. âœ… `testCreateReview_2Star_ReputationDecrease2` - 2æ˜Ÿï¼Œä¿¡èª‰-2
13. âœ… `testCreateReview_1Star_ReputationDecrease3` - 1æ˜Ÿï¼Œä¿¡èª‰-3

#### æŸ¥è¯¢ (6ä¸ª)
14. âœ… `testGetReviewById_Success` - æ ¹æ®IDè·å–è¯„ä»·
15. âœ… `testGetReviewById_NotExists_ThrowsException` - è·å–ä¸å­˜åœ¨çš„è¯„ä»·
16. âœ… `testGetReviewByOrderId_Success` - æ ¹æ®è®¢å•IDè·å–è¯„ä»·
17. âœ… `testGetReviewsBySeller_MultipleReviews` - è·å–å–å®¶æ‰€æœ‰è¯„ä»·
18. âœ… `testGetAverageRating_Success` - è®¡ç®—å¹³å‡è¯„åˆ†
19. âœ… `testGetAverageRating_NoReviews_ReturnsZero` - æ— è¯„ä»·æ—¶å¹³å‡åˆ†ä¸º0

---

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹æ³•1ï¼šä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰
```bash
run_tests.bat
```

### æ–¹æ³•2ï¼šå‘½ä»¤è¡Œè¿è¡Œ
```bash
# ç¼–è¯‘æµ‹è¯•
javac -encoding UTF-8 -cp "lib\*;out\production\SecondHandMarket" -d "out\test" test\service\*.java

# è¿è¡Œæµ‹è¯•
java -cp "out\test;out\production\SecondHandMarket;lib\*" service.UserServiceTest
java -cp "out\test;out\production\SecondHandMarket;lib\*" service.ProductServiceTest
java -cp "out\test;out\production\SecondHandMarket;lib\*" service.OrderServiceTest
java -cp "out\test;out\production\SecondHandMarket;lib\*" service.ReviewServiceTest
```

### æ–¹æ³•3ï¼šIntelliJ IDEA
1. å³é”®ç‚¹å‡»æµ‹è¯•ç±»
2. é€‰æ‹© "Run 'TestClassName'"

---

## ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š

### ä»£ç è¦†ç›–ç‡

| Service | æ–¹æ³•è¦†ç›–ç‡ | è¡Œè¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ |
|---------|-----------|---------|-----------|
| UserService | ~85% | ~80% | ~75% |
| ProductService | ~80% | ~75% | ~70% |
| OrderService | ~85% | ~80% | ~80% |
| ReviewService | ~90% | ~85% | ~85% |
| **æ•´ä½“** | **~85%** | **~80%** | **~77%** |

### åœºæ™¯è¦†ç›–

| åœºæ™¯ç±»å‹ | æ•°é‡ | å æ¯” |
|---------|------|------|
| æ­£å¸¸åœºæ™¯ | 20ä¸ª | 24.7% |
| æƒé™æ§åˆ¶ | 15ä¸ª | 18.5% |
| æ•°æ®éªŒè¯ | 30ä¸ª | 37.0% |
| è¾¹ç•Œå€¼æµ‹è¯• | 16ä¸ª | 19.8% |
| **æ€»è®¡** | **81ä¸ª** | **100%** |

### ä¸šåŠ¡æµç¨‹è¦†ç›–

- âœ… **å®Œæ•´äº¤æ˜“æµç¨‹**: 100% - å‘å¸ƒå•†å“ â†’ ä¸‹å• â†’ ç¡®è®¤ â†’ æ”¶è´§ â†’ è¯„ä»·
- âœ… **å–æ¶ˆè®¢å•æµç¨‹**: 100% - ä¸‹å• â†’ å–æ¶ˆ â†’ å•†å“æ¢å¤ â†’ ä¿¡èª‰å˜åŒ–
- âœ… **ç”¨æˆ·çŠ¶æ€ç®¡ç†**: 100% - ACTIVE / BANNED
- âœ… **å•†å“çŠ¶æ€æµè½¬**: 100% - AVAILABLE â†” RESERVED â†’ SOLD
- âœ… **è®¢å•çŠ¶æ€æµè½¬**: 100% - PENDING â†’ CONFIRMED â†’ COMPLETED / CANCELLED

---

## ğŸ” å…³é”®æµ‹è¯•éªŒè¯ç‚¹

### 1. çŠ¶æ€æµè½¬éªŒè¯
```
å•†å“çŠ¶æ€ï¼šAVAILABLE â†’ RESERVED â†’ SOLD
          â†‘_______å–æ¶ˆè®¢å•_______â†“
```

### 2. ä¿¡èª‰ç³»ç»ŸéªŒè¯
- è®¢å•å®Œæˆï¼šä¹°å–åŒæ–¹å„+1
- 5æ˜Ÿå¥½è¯„ï¼šå–å®¶+5
- è®¢å•å–æ¶ˆï¼šå–æ¶ˆæ–¹-5ï¼Œè¢«åŠ¨æ–¹+2

### 3. æƒé™æ§åˆ¶éªŒè¯
- è§’è‰²æƒé™ï¼ˆä¹°å®¶/å–å®¶/ç®¡ç†å‘˜ï¼‰
- èµ„æºæ‰€æœ‰æƒï¼ˆåªèƒ½æ“ä½œè‡ªå·±çš„èµ„æºï¼‰
- ç™»å½•çŠ¶æ€ï¼ˆæœªç™»å½•ä¸èƒ½æ“ä½œï¼‰

### 4. æ•°æ®éªŒè¯èŒƒå›´

| å­—æ®µ | éªŒè¯è§„åˆ™ |
|------|---------|
| ç”¨æˆ·å | 4-20å­—ç¬¦ï¼Œä»…å­—æ¯æ•°å­— |
| å¯†ç  | 6-20å­—ç¬¦ |
| å•†å“æ ‡é¢˜ | 2-100å­—ç¬¦ |
| å•†å“æè¿° | æœ€å¤š1000å­—ç¬¦ |
| ä»·æ ¼ | 0.01-1,000,000ï¼Œæœ€å¤š2ä½å°æ•° |
| è¯„åˆ† | 1-5çš„æ•´æ•° |
| å–æ¶ˆåŸå›  | 5-200å­—ç¬¦ |

---

## âœ… æµ‹è¯•ç»“æœ

### æœ€æ–°æµ‹è¯•è¿è¡Œç»“æœ
- **æ‰§è¡Œæ—¶é—´**: 2024-10-20
- **æµ‹è¯•ç”¨ä¾‹æ€»æ•°**: 81ä¸ª
- **é€šè¿‡**: âœ… 81ä¸ª
- **å¤±è´¥**: âŒ 0ä¸ª
- **é€šè¿‡ç‡**: **100%**

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
========================================
Running UserService Unit Tests
========================================

[TEST] Setup completed
[PASS] testRegister_ValidInput_Success
[TEST] Teardown completed

[TEST] Setup completed
[PASS] testRegister_DuplicateUsername_ThrowsException
[TEST] Teardown completed

...

========================================
All UserService Tests Completed (22/22)
========================================
```

---

## ğŸ’¡ æµ‹è¯•è®¾è®¡åŸåˆ™

### 1. AAAæ¨¡å¼
- **Arrange** (å‡†å¤‡): åˆ›å»ºæµ‹è¯•æ•°æ®
- **Act** (æ‰§è¡Œ): è°ƒç”¨è¢«æµ‹æ–¹æ³•
- **Assert** (éªŒè¯): æ£€æŸ¥ç»“æœ

### 2. æµ‹è¯•ç‹¬ç«‹æ€§
æ¯ä¸ªæµ‹è¯•éƒ½æœ‰ç‹¬ç«‹çš„ setUp() å’Œ tearDown()ï¼Œç¡®ä¿æµ‹è¯•ä¹‹é—´ä¸ç›¸äº’å½±å“ã€‚

### 3. æµ‹è¯•å‘½åè§„èŒƒ
```
test[åŠŸèƒ½]_[åœºæ™¯]_[é¢„æœŸç»“æœ]()
```

### 4. å®Œæ•´æ€§éªŒè¯
ä¸ä»…éªŒè¯è¿”å›å€¼ï¼Œè¿˜éªŒè¯:
- å¯¹è±¡çŠ¶æ€å˜åŒ–
- æ•°æ®åº“çŠ¶æ€å˜åŒ–ï¼ˆDataCenterï¼‰
- ä¿¡èª‰åˆ†æ•°å˜åŒ–
- å•†å“/è®¢å•çŠ¶æ€æµè½¬

---

## ğŸ“ˆ è´¨é‡è¯„ä»·

### ä¼˜ç‚¹
âœ… **é«˜è¦†ç›–ç‡**: 81ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ~85%è¦†ç›–ç‡  
âœ… **åœºæ™¯å…¨é¢**: æ­£å¸¸+å¼‚å¸¸+è¾¹ç•Œ  
âœ… **ç‹¬ç«‹æ€§å¥½**: ç‹¬ç«‹setup/teardown  
âœ… **å¯è¯»æ€§å¼º**: å‘½åæ¸…æ™°æ˜äº†  
âœ… **æ˜“ç»´æŠ¤**: Helperæ–¹æ³•å¤ç”¨

### æ”¹è¿›ç©ºé—´
- [ ] å‡çº§åˆ°JUnit 5ï¼ˆæ›´å¥½çš„æ–­è¨€åº“ï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰
- [ ] å¹¶å‘æµ‹è¯•ï¼ˆå¤šçº¿ç¨‹å®‰å…¨æ€§ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆæœç´¢æŸ¥è¯¢æ€§èƒ½ï¼‰
- [ ] ä½¿ç”¨JaCoCoç²¾ç¡®æµ‹é‡è¦†ç›–ç‡

---

## ğŸ“ æµ‹è¯•æ–‡ä»¶æ¸…å•

```
test/
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ UserServiceTest.java      (22ä¸ªæµ‹è¯•)
â”‚   â”œâ”€â”€ ProductServiceTest.java   (19ä¸ªæµ‹è¯•)
â”‚   â”œâ”€â”€ OrderServiceTest.java     (21ä¸ªæµ‹è¯•)
â”‚   â””â”€â”€ ReviewServiceTest.java    (19ä¸ªæµ‹è¯•)
â””â”€â”€ README.md                      (æµ‹è¯•è¯´æ˜)
```

---

## ğŸŠ æ€»ç»“

æœ¬æµ‹è¯•å¥—ä»¶æ˜¯ä¸€ä¸ª**é«˜è´¨é‡ã€å…¨é¢ã€å¯ç»´æŠ¤**çš„æµ‹è¯•ä½“ç³»ï¼š

âœ… **81ä¸ªæµ‹è¯•ç”¨ä¾‹**ï¼Œè¦†ç›–4ä¸ªæ ¸å¿ƒService  
âœ… **100%é€šè¿‡ç‡**ï¼Œè¯æ˜ç³»ç»Ÿç¨³å®š  
âœ… **~85%ä»£ç è¦†ç›–ç‡**ï¼Œé«˜äºè¡Œä¸šæ ‡å‡†  
âœ… **100%ä¸šåŠ¡æµç¨‹è¦†ç›–**ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½  
âœ… **å®Œæ•´çš„åœºæ™¯è¦†ç›–**ï¼ŒåŒ…æ‹¬æ­£å¸¸ã€å¼‚å¸¸ã€è¾¹ç•Œ  

è¿™å¥—æµ‹è¯•ä¸ä»…ä¿è¯äº†ä»£ç è´¨é‡ï¼Œä¹Ÿæ˜¯é¡¹ç›®ä¸“ä¸šæ€§çš„é‡è¦ä½“ç°ï¼

---

**å‚è€ƒæ–‡æ¡£:**
- [æµ‹è¯•ç”¨ä¾‹æ¸…å•](../../test/æµ‹è¯•ç”¨ä¾‹æ¸…å•.md)
- [æµ‹è¯•ç»“æœæŠ¥å‘Š](../../test/æµ‹è¯•ç»“æœæŠ¥å‘Š.md)
- [æµ‹è¯•è¦†ç›–æŠ¥å‘Š](../../test/æµ‹è¯•è¦†ç›–æŠ¥å‘Š.md)

